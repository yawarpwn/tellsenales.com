---
import { readdir } from 'node:fs/promises'
import MainLayout from "@layouts/main-layout.astro";
import fs from 'fs'
import path from 'path'


async function getAllPaths(dir) {
  let files = []
  const entries = await readdir(dir, { withFileTypes: true})
  for (const entry of entries) {
    if(entry.isDirectory()) {
      const deepDir = await getAllPaths(`${dir}/${entry.name}`)
      files = [...files,...deepDir]
    } else {
      files.push(`${dir}/${entry.name}`)
    }
  }
  return files
}

const dirURL = import.meta.env.DEV ? 'public/galery' : '../../../galery'
const allImages = await getAllPaths(dirURL)
const entries = await readdir(dirURL)
const allPathImages = entries.map(entry => {
  return {
    paths: allImages.filter(img => img.includes(entry)),
    title: entry
  }
})



// const paths = allImages.map(path => path.split('public')[1])
// const category = paths.map(path => path.)
// console.log(paths)



const content = { 
  title: 'Galeria',
  description: 'Nuestra galeria de trabajos',
  image: '/assets/images/chevron.webp'
}
---
<MainLayout hideRightSidebar {content}>
  <div class="px-4 md:px-0">
    <h1 class="text-center">Galeria</h1>
    <p class="max-w-5xl">
      Con dedicación, esfuerzo y buen desempeño, hemos desarrollado a lo largo de los años diversas soluciones para nuestros clientes.
      A continuación, queremos enseñarles algo de lo que hemos hecho:
    </p>
    {allPathImages.map(({paths, title}) => {
      return (
        <h2 class="uppercase text-2xl">Señales {title}</h2>
        <div class="flex overflow-x-scroll gap-4">
          {paths.map(path => {
              return(
          <img src={path} width="300" height="auto" />
          )}
            )}
        </div>
      )
    })}
  </div>


</MainLayout>
